# Создание и импорт моделей из Blender 2.9 в Gazebo 11

## Загрузка Blender

**Blender** – проект 3д редактора для растровой графики с открытым исходным кодом.
Он доступен бесплатно для загрузки с официального сайта [blender](www.blender.org) для всех основных ОС.


* **Windows 7, 8, 10** – доступен установщик в формате msi.<br><br>
* **Linux (Debian и Ubuntu)** – установка в виде deb пакета. Также установка
 может производиться из стандартных репозиториев с помощью утилиты apt или
 менеджеров пакетов aptitude и synaptic. Однако, в данном случае, вы получите
 более старую версию программы.<br><br>
* **Mac OS** – установка из образа данных диска в формате dmg.<br><br>
* **Прочие системы** –  доступна сборка из исходников.

Сам процесс установки является тривиальным и в данной статье рассматриваться
не будет.


<text style="color: red">Внимание!</text>
В конце установки при первом запуске программы будет предложен выбор настроек выделения объектов, вращения камеры и перемещения. Выбираете более удобный для
вас вариант. В данном руководстве используется пресет настроек Blender 27x.

  ![preset](/images/preset.png)

## Основы работы в Blender 2.9

### Интерфейс программы

![](/images/interface.png)

1. ViewPort – Окно 3д просмотра сцены.
2. Outliner – Дерево проекта. Все объекты в текущем проекте, объединенные в иерархические группы.
3. Properties – Свойства сцены, объекта, мира и тд.
4. TimeLine – Окно с временной шкалой для создания анимации.

Данные компоненты интерфейса могут масштабироваться и взаимозаменяться в
зависимости от текущих задач и предпочтений конкретного пользователя.

### Режимы работы
Два основных режима работы в blender, в которых пользователи проводят большую
часть времени это объектный режим и режим редактирования. Их переключение осуществляется через клавишу **Tab**.

- Объектный режим служит для перемещения, масштабирования, вращения объектов по пространству сцены.
- Режим редактирования используется для изменения геометрии объектов и экструдирования (выдавливания) моделей.

### Основы работы в объектном режиме
#### Выбор вида

Выбор вида осуществляется с помощью цифровых клавиш клавиатуры на блоке **numpad**.


| Вид                    | Отображение                   |
| :--------------------- | ----------------------------: |
| Изначальный вид сцены  | ![](/images/default_view.png) |
| 1 – вид спереди        | ![](/images/forward_view.png) |
| 3 – вид сбоку          | ![](/images/side_view.png)    |
| 7 – вид сверху         | ![](/images/up_view.png)      |
| 5 – смена ортографической и перспективной проекции     | ![](/images/ortographic_view.png) |
| 0 – вид с камеры       | ![](/images/camera_view.png) |
| /  – локальный режим.Данный режим скрывает все объекты кроме выделенного, это может быть полезным при редактировании. Повторное нажатие вернет Вас в глобальный режим.  |![](/images/local.png)         |

### Добавление и удаление объектов
Blender изначально располагает набором геометрических примитивов для построения
на их основе сложных объектов путем редактирования и объединения.

Для добавления объекта необходимо поместить курсор в пространство ViewPort и
нажать **shift+A**. Для построения простых сцен Вам будет достаточно раздела
*Mesh*. Он содержит все необходимые геометрические примитивы.

<div style="text-align: center;">

  ![](/images/adding_mesh.png)

</div>

После создания объекта в правом нижнем углу появится окно свойств объекта.

<div style="text-align: center;">

  ![](/images/mesh_properties.png)

</div>

Для удаления объектов выделите нужные объекты и нажмите X.
<div style="text-align: center;">

 ![](/images/deleting_meshes.png)
</div>


### Выделение объектов
Для выделения объекта, грани, вершины или ребра применяется ПКМ или ЛКМ в зависимости от настроек, что были выбраны при установке. Чтобы выделить все объекты в сцене – нажмите A. Повторное нажатие снимает выделение со всех объектов.

### Специальные режимы выделения
Если требуется быстро выделить несколько объектов или область объекта в режиме редактирования, то можно применить следующие режимы:
- Выделение рамкой – клавиша **B**.
- Выделение круговой области – клавиша **C**. Вращение колеса мышки изменяет размер области.

### Перемещение, вращение, масштабирование
Для всех действий можно ограничить их применение по одной или двум осям.

Для того чтобы ограничить выбор одной осью нажмите клавишу x, y, z после нажатия клавиши действия. Чтобы оставить лишь две оси и работать с ними, исключите 3ью ось нажатием shift+[x, y, z]

| Перемещение     | Вращение     |  Масштабирование   |
| :-------------: | :----------: | :----------------: |
|      **G**      |      **R**   |        **S**       |

## Основы моделирования
### Предварительная настройка сцены

Зайдите на вкладку **Scene** в окне свойств и установите метрическую систему мер. Это упростит дальнейшее создание модели и ее экспорт в Gazebo
<div style="text-align: center;">

 ![](/images/select_metric.png)
</div>

### Режимы выделения
При редактировании объекта мы можем работать в одном из трех способов выделения текущего меша:
- вершины
- ребра
- грани
Для их смены используете меню иконок в левой верхней части рабочего экрана или комбинацию клавиш **ctrl+tab**
s
![](/images/mesh_select_mode.png)

Для выделения нескольких граней, ребер или вершин удерживаете shift. Удерживание Alt позволяет выделить непрерывную линию данных элементов. Например, вершины, расположенные по кругу.

### Экструдирование
Основой создания новых объектов является – экструдирование. Для его выделите ребра или грани, требующие экструдирования, и нажмите **E**.
Автоматически экструдирование производится в направлении вектора нормали текущей грани или сумме векторов граней. Однако, к нему также можно применять ограничения по осям, описанное в разделе «Перемещение, вращение, масштабирование». Для того, чтобы выдавить грань на заданное расстояние нажмите E, выберите требуемую ось и введите расстояние на клавиатуре.

#### Пример экструдирования

**Создание столба, экструдированием круга по оси Z  на 5 метров вверх**

1. Добавляем круг

<div style="text-align: center;">

 ![](/images/example1.png)
</div>

2. В окне свойств понизим количество вершин до 16, уменьшим радиус до 10см и установим тип заполнения Triangle Fan

<div style="text-align: center;">

 ![](/images/example2.png)
</div>

3. Переходим в режим редактирования (**tab**). Выделяем все грани **A**

<div style="text-align: center;">

 ![](/images/example3.png)
</div>

4. Нажимаем клавишу **E**, Нормаль круга совпадает с осью Z, поэтому ограничение указывать не требуется. Набираем на клавиатуре **5** и делаем клик ЛКМ.

<div style="text-align: center;">

 ![](/images/example4.png)
</div>

Основа столба в виде цилиндра готова.

### Добавление ребер

Для добавления ребер в режиме редактирования нажмите **Ctrl+R** и подведите курсор к грани объекта. Вращение колеса мышки увеличивает количество ребер.

<div style="text-align: center;">

 ![](/images/adding_ribs.png)
</div>

### Инструмент нож
Активируется нажатием **K**, позволяет разрезать грани объектов.
<div style="text-align: center;">

 ![](/images/knife.png)
</div>
Для фиксации под угол 0, 90 или 45 градусов нажмите **C**. После окончания реза необходимо нажать Enter для подтверждения.


### Подключение дополнений
Стандартный набор мешей можно значительно расширить подключив разнообразные аддоны. Для быстрого прототипирования сцен рекомендуется подключить
- Archimesh
- Archipack
- Extra Objects

Для их добавления перейдите в раздел *edit->preferences->addons*. Найдите пакеты Archimesh, Archipack и Extra Objects. Отметьте их галочками.
<div style="text-align: center;">

 ![](/images/adding_addons.png)
</div>
<text style="color: red">Внимание!</text>
Пакет Archipack требует предварительного рендера, для этого, после установки галочки, нажмите кнопку render presents thumbs, дождитесь завершения процесса и перезапустите Blender.

После этого в разделе Mesh появятся новые пункты.
<div style="text-align: center;">

 ![](/images/new_meshes.png)
</div>
Не игнорируйте данные разделы. Они  содержат множество объектов, которые будут полезны новичкам и ускорят создание сцены. Дополнительные модели можно найти в публичных репозиториях в Интернете

## Импорт моделей в формат .dae
Для экспорта модели выберете

    File -> Export -> Collada (.dae)

Расставляем настройки осей, как указано на рисунке. По умолчанию все объекты, находящиеся в сцене, будут превращены в одну модель. Если требуется добавить только выделенные объекты, то указываем Selection Only.
<div style="text-align: center;">

 ![](/images/export_preferences.png)
</div>

В разделе **Geom** выбираем конвертацию граней в треугольники, а также применение модификаторов, если таковые были.
<div style="text-align: center;">

 ![](/images/geom_export.png)
</div>

После этого выбираем место сохранения модели, вводим имя латинскими буквами и нажимаем кнопку **Export**

### Загрузка модели в Gazebo

В Gazebo необходимо перейти в режим моделирования комбинацией **Ctrl+M**

<div style="text-align: center;">

 ![](/images/gazebo_empty.jpg)
</div>

Нажать кнопку Add в разделе Insert – Custom Shapes. Появится форма добавления модели. Укажите путь к ней, а  также дайте ей имя.
<div style="text-align: center;">

 ![](/images/import_link.jpg)
</div>

Разместите модель в окне просмотра.
<div style="text-align: center;">

 ![](/images/model_in_gazebo.png)
</div>

Нажмите

    File->Save as.

Заполните описание модели, указав имя, описание и авторство.
<div style="text-align: center;">

 ![](/images/save_model.jpg)
</div>

После этого можно сохранить модель в удобное для вас место. По умолчанию, Gazebo создаст в вашей домашней директории папку для пользовательской коллекции моделей. В дальнейшем подобную модель можно использовать наряду со стандартными объектами. Добавляя ее в свой мир в разделе Insert.
